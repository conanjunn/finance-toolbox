# 投资学

## 前言

这其实是我学习博迪《投资学》和财大刘志东老师的“投资学课程”的笔记。

学投资学的初衷，是由于自己确实有让自己资产保值增值的需求，毕竟每年6%的通胀率，你不让你的钱保值增值，就会被这个社会收割6%的通胀税。可是，你要把你的资产做到6%的收益率，可不是件容易的事啊，你看现在的银行的各类理财产品，也就是4%左右的收益率。你要是看到5%、6%的产品，都被贴上了高收益、高风险的标签了，可是，6%是起码要达到的收益率呀。基于此，至少为了让自己的资产可以不缩水，必须、有必要认真学习一下投资学的内容。

我是带着问题来学习的，我其实对投资这块，脑子里是有一大堆问题的：
- 我是个风险厌恶型的人，那么我多少钱应该买无风险的资产，多少钱买有风险的资产？
- 那么，到底什么是无风险资产？他们的收益率能到多少？
- 啥是风险？到底怎么来衡量风险？
- 组合就好么？无风险+有风险资产如何组合？有风险资产内部如何组合（比如多少股票，多少基金）？基金应该挑选那些？
- 如何择时？也就是何时入场、何时立场？
- 有没有什么对冲手段么？比如保险、期货对冲，没想赚啥杠杆的钱，就想对冲，这种工具有么，有哪些？
- 系统性风险究竟能不能对冲掉？如果来了，如何甄别和规避？

如果是6%的收益率，也就是抵御通胀的收益率的话，100万，10年，可以变成180万，赚80%的收益率；10%的话，7年就可以翻倍，复利的力量：

![](src#/images/20210502/1619940365914.jpg)

但是，前提是，你真的可以保证你有能力做到持续的6%+的正收益，所以，我想通过自己的学习和研究，想找个目标迈进。

另外，这个笔记其实很简单的，只记录了我觉得最需要的一些**“干货”**，没有详细和冗余的解释，但是，如果要全面和深刻掌握，还是得去认真深入学习，
比如夏普的《投资学》、博迪的《投资学》、徐高的《徐高 - 金融经济学二十五讲》、中央财经大学的“投资学”课程、王蓁老师的量化投资课程等。
请参考我最后一章的附录，可以获得更多细节。


## 衡量风险收益

期望回报率是对未来资产回报率的预估，注意，是**未来**！可是，我们无法预知未来，所以，我们往往用过去的资产收益情况，来预估未来。

我们用过去资产的回报率来当做未来的收益率，用过去的波动率（也就是标准差）来当做未来的波动，这只是一种没办法的替代而已，
所以，千万不要忘记这点，也千万别“忽悠”了自己，时刻牢记，过去无法代表未来，对未来的不确定性，永远保持敬畏。

我们往往用过去资产的收益的均值，来“估计”资产的收益期望（注意，包含了未来）；

我们往往用过去资产的收益的标准差，来“估计”资产的风险，这个也好理解，方差代表了波动，波动大的资产，我们就认为风险大；


## 无差异曲线

你冒险就希望多收益，对吧？你降低风险，对收益预期也降低。所以，你的投资的好恶就可以用一个平滑曲线表示。

而我冒同样的险，跟你的收益不一样，所以我的好恶曲线，和你的不一样。

所谓**无差异**，是说，你对预期的感受是一致的，风险大了你就觉得收益就大点，风险小收益就小，你**“认”**这个感受，你觉得这个风险低，收益只能是这些，你接受。
在我理解，其实一个无差异曲线，往往对应着一个或者一类投资产品。

用数学表达就是：$$U=E(r)-0.005 A \sigma^{2}$$，这里面变量是$$E(r),\sigma^2$$，不变的是这个人的好恶$$A$$。

![](/images/20211013/1634112392892.jpg)

这里的$$I_1,I_2,I_3$$，都是一个人的，你可以理解成对不同的投资标的的风险接受程度。而对同一个投资产品，他的收益预期和风险偏好就是一条曲线。
且，这个人的这些偏好曲线都是不相交的。

![](/images/20211013/1634112524127.jpg)

不同人的无差异曲线，他们的**“陡峭”**程度不一样，越陡，越厌恶风险。

为何是**下凸**的呢？

是因为，风险越大，人们对收益的期待就约**“偏大”**，曲线就偏陡；而风险小，预期收益就小，曲线就平缓，所以，就是一个下凸的曲线。


## 均值方差分析

几个基本公式先列一下，

均值：$$\bar{r}=\frac{1}{N} \sum_{i=1}^{N} r_{i}$$

方差：$$\sigma_{r}^{2}=\frac{1}{N} \sum_{i=1}^{N}\left(r_{i}-\bar{r}\right)^{2}$$

标准差：$$\sigma_{r}=\sqrt{\frac{1}{N} \sum_{i=1}^{N}\left(r_{i}-\bar{r}\right)^{2}}$$

协方差：$$\sigma_{x y}=\frac{1}{N} \sum_{i=1}^{N}\left(x_{i}-\bar{x}\right)\left(y_{i}-\bar{y}\right)$$

相关系数：$$\rho_{x y}=\frac{\sigma_{x y}}{\sigma_{x} \sigma_{y}}$$

但其实，我们是假设，过去的分布和未来相同，过去的模式会在未来不断重复出现，所以，我们可以用把这种历史数据的计算扩展到期望，即：

均值：$$\bar{r}=E(r)=\sum_{j=1}^M p_j r_j$$

方差：$$\sigma_{r}^{2}=E(r-\bar{r})$$

相关系数：$$\rho_{x y}=E(x-\bar{x})(y-\bar{y})$$

这些式子，在数学意义上不是严格相等，但是，在上面提到的金融假设上，就近似相等了。可是，过去就代表未来么？这个问题值的深思。


## 偏度和峰度

前面我们说过，我们考察一个投资产品，把他过去的、历史的，用来作为未来的投资的最大参考。
我们用过去的均值$$\bar{r}$$来作为未来收益率的期望$$E(r)$$，我们用过去的标准差$$\sigma$$来作为未来收益率的波动的度量。
但是，这就够了么？不。我们还可以用偏度，和峰度，来帮着我们更深入的去考察资产的收益率。

**偏度**

我们用偏度来判断，这个分布是不是个“优质分布”，优质分布应该偏度>0:

![](/images/20211013/1634118951259.jpg)

看图说话，我们肯定喜欢右面的那个，偏度>0的那个分布，对吧，大部分都是更高的收益，而右面那个比较差的收益多。

**峰度**

我们用峰度来判断，这个分布是不是个“优质分布”，优质分布应该峰度>3:

![](/images/20211013/1634119047824.jpg)

黄色的是正态分布，峰度=3，我们当然希望峰度>3的，因为这样波动率（标准差）小啊，收益率更稳定啊。

## 组合的正态性

我们当然希望，我们可以预测的收益率是呈现一个正态分布。为何呢？因为正态分布是我们最有掌控感，可以用数学刻画出来的分布。
用均值和方差，就可以比较“精确”地描述它了。但是如果他不是正态分布，左右偏一些的话，你很难去对他进行数学建模了。

比如正态分布的话，你就可以比较精确地算出在多大概率下，它的波动率（标准差）会是多少。

![](/images/20211013/1634121712163.jpg)

看这种别人统计的，美股的图，它是一年期的收益，抽样了无数股票，单抽1个的时候，收益率其实不太符合正态分布。
但是到了128个的时候，他们的平均组合收益率，已经非常接近正态分布了（观察偏度=0了）。


## 无风险和风险资产组合

无风险收益$$r_f$$和风险资产收益$$r_s$$，他们组合到一起，收益如何表达呢？表达成：组合收益均值$$r_p$$、组合收益方差$$\sigma_p$$:

$$
\begin{aligned}
\bar{r}_{p}&=E\left[(1-w) r_{f}+w r_{s}\right]\\
		   &=(1-w) r_{f}+w \bar{r}_{s}\\
		   &=r_{f}+w\left(\bar{r}_{s}-r_{f}\right) \\
\sigma_{p}^{2}&=E\left[(1-w) r_{f}+w r_{s}- \\
		(1-w) r_{f}-w \bar{r}_{s}\right]^{2}\\
&=E\left[w^{2}\left(r_{s}-\bar{r}_{s}\right)^{2}\right]\\
&=w^{2} \sigma_{s}^{2}
\end{aligned}
$$

然后，把这两者组合收益均值$$r_p$$、组合收益方差$$\sigma_p$$的关系表达出来：

$$\bar{r}_{p}=r_{f}+\frac{\bar{r}_{s}-r_{f}}{\sigma_{s}} \sigma_{p}$$

这是个线性关系，你愿意承担更大的风险$$\sigma_p$$，你就可以得到更高的收益$$\bar{r_p}/E(r_p)$$，而直线的斜率是个常数$$\frac{\bar{r}_{s}-r_{f}}{\sigma_{s}}$$。

这个直线也叫：**资本配置线CML**

![](/images/20211013/1634105867823.jpg)

现在，把资本配置线CML和无差异曲线结合起来：

![](/images/20211013/1634115715511.jpg)

这图啥意思？想表达啥？

上面那条无差异曲线，当然好，效用比较高（就是同样风险/标准差下，它收益更高），可是，你做梦吧，因为根本“实现不了”。

为何实现不了？资本配置线CML是啥来着？是你调整你有风险和无风险的组合权重，得到一个组合收益的曲线。所以，你根本无法达到上面那条"预期"的无差异曲线的预期。

那你如果选下面那条无差异曲线呢？你如果选它，你是可以达到“它”期待的预期，但是，你同样风险/标准差下，本可以达到中间那条无差异曲线所能期待的更高收益呢。你何必呢？

切点**C**代表啥？

代表了，你最能达到最大效用预期，被满足啦，你呀，按照C点的权重，去配置的无风险和有风险资产，会让你的效用预期最大（无差异曲线被满足），且，也是个可是“实现”的一个组合。



## 两种风险资产组合
$$
\begin{array}{ll}
\bar{r}_{1}=E\left(r_{1}\right)\\
\bar{r}_{2}=E\left(r_{2}\right) \\
\sigma_{1}^{2}=E\left(r_{1}-\bar{r}_{1}\right)^{2} \\
\sigma_{2}^{2}=E\left(r_{2}-\bar{r}_{2}\right)^{2} \\
\sigma_{12}=E\left(r_{1}-\bar{r}_{1}\right)\left(r_{2}\right. & \left.-\bar{r}_{2}\right)
\end{array}
$$

好，我们现在给第一个分配权重$$w$$，那第二种资产权重是$$1-w$$

组合收益均值：

$$\bar{r}_{p}=E(r)=w \bar{r}_{1}+(1-w) \bar{r}_{2}$$

组合收益方差：
$$
\begin{aligned}
\sigma_{p}^{2} &=E\left[w r_{1}+(1-w) r_{2}-\left(w \bar{r}_{1}+(1-w) \bar{r}_{2}\right)\right]^{2} \\
&=E\left[w\left(r_{1}-\bar{r}_{1}\right)+(1-w)\left(r_{2}-\bar{r}_{2}\right)\right]^{2} \\
&=E\left[w^{2}\left(r_{1}-\bar{r}_{1}\right)^{2}+(1-w)^{2}\left(r_{2}-\bar{r}_{2}\right)^{2}+\\
	2 w(1-w)\left(r_{1}-\bar{r}_{1}\right)\left(r_{2}-\bar{r}_{2}\right)\right] \\
&=w^{2} \sigma_{1}^{2}+(1-w)^{2} \sigma_{2}^{2}+2 w(1-w) \sigma_{12}
\end{aligned}
$$

可变的变量是$$w$$，来调整第一个风险资产和第二个风险资产的组合。

那最优的$$w^{*}$$应该是多少好呢？就是这个$$w^{*}$$下，组合收益最大：

$$
\begin{aligned}
&\frac{\partial \sigma_{p}^{2}}{\partial w}=0 \\
& \Rightarrow 2 \sigma_{1}^{2} w^{*}-2 \sigma_{2}^{2}\left(1-w^{*}\right)+2 \sigma_{12}-4 \sigma_{12} w^{*}=0 \\
& \Rightarrow 2 \sigma_{1}^{2} w^{*}-2 \sigma_{2}^{2}+2 \sigma_{2}^{2} w^{*}+2 \sigma_{12}-4 \sigma_{12} w^{*}=0 \\
& \Rightarrow \sigma_{1}^{2} w^{*}-\sigma_{2}^{2}+\sigma_{2}^{2} w^{*}+\sigma_{12}-2 \sigma_{12} w^{*}=0 \\
& \Rightarrow\left(\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}\right) w^{*}=\sigma_{2}^{2}-\sigma_{12} \\
& \Rightarrow w^{*}=\frac{\sigma_{2}^{2}-\sigma_{12}}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}}
\end{aligned}
$$

那，最好的收益均值（$$\bar{r_p}^{*}$$）是多少？

$$
\begin{aligned}
\bar{r}_{p}^{*} &=w^{*} \bar{r}_{1}+\left(1-w^{*}\right) \bar{r}_{2} \\
&=\frac{\sigma_{2}^{2}-\sigma_{12}}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}} \bar{r}_{1}+\left(1-\frac{\sigma_{2}^{2}-\sigma_{12}}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}}\right) \overline{r_{2}} \\
&=\frac{\sigma_{2}^{2}-\sigma_{12}}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}} \bar{r}_{2}+\frac{\sigma_{1}^{2}-\sigma_{12}}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}} \bar{r}_{2} \\
&=\frac{\sigma_{1}^{2} \bar{r}_{2}+\sigma_{2}^{2} \bar{r}_{1}-\sigma_{12}\left(\bar{r}_{1}+\bar{r}_{2}\right)}{\sigma_{1}^{2}+\sigma_{2}^{2}-2 \sigma_{12}}
\end{aligned}
$$

好吧，看图就明白了，最优的点，就是方差最小的这个点：

![](/images/20211013/1634108422355.jpg)

不过这个，曲线可不是一直都是个曲线，当这两种风险资产的相关性（可以用相关系数$$\rho$$来衡量）不同的时候，曲线的形态也不同：

![](/images/20211013/1634108633696.jpg)

## 多种风险资产组合

上面是两种风险资产组合，那一堆（**多种**）资产组合在一起，啥样呢？那就不是个曲线了，而是一个区域了。

![](/images/20211013/1634108782826.jpg)

这个区域中，我们只关心同等风险（标准差）下，收益最大的那个组合，对吧？所以，这些点就形成了一个叫“有效前沿”的曲线：

![](/images/20211013/1634109238225.jpg)

这个求解，组合少的时候，可以用拉格朗日优化方式直接求解，组合比较多的时候，往往通过蒙特卡洛采样得到。

## 市场组合

上面，我们探讨了无风险和有风险组合的关系，就是“资本市场线CML”；还探讨了有风险的组合（2种-曲线、和推广都多种-曲面）；
现在，我们把这两者结合起来：

![](/images/20211015/1634281293504.jpg)

看这种图，我们逐一解释：

**M点**：

是过$$r_f$$的直线（也就是资本市场线CML），和有效前沿的切点。它代表了最优的投资组合。为何是最优？
因为任何高于这个切点的直线（资本市场线CML），都是不可能实现的，因为没碰到任何投资组合区域的内容。
而低于这个切点的直线（资本市场线CML），斜率都是低于切线，也就是投资的效率都低（多投1块钱，获得收益更少），
所以，切线是最优的。

**A点**：

A点，是A点所属的这个人的无差异曲线，其中的一条，也就是这个人所期盼的：“效用预期”最大（越往左上角收益越大），且是“可实现”（不相交就没法实现收益啊）。

而此时，这个A点，也就是最优的一个的无风险$$r_f$$和市场组合$$r_m$$的最优的“我”最喜欢的组合收益$$r_p$$了。

**B点**：

这个是另外一个人的无差异曲线和资本市场线的切线，也就是B所属的这个人，他最优的投资组合。

## CAPM

CAPM太经典了，经典到是现代金融的一个开启的奠基之作。

它说了一件什么事呢？

还记得上节我们说，有限前沿和无风险利率的切线，得到了切点M，应该就是市场组合的最优解，对吧？
那市场组合，咋组合法？是应该包含了全世界所有的风险资产，对吧？
那么，CAPM说的就是，这个最优解，就是市场的现状，市场变动来变动去，最终都会**均衡**收敛到这个点。
嗯，你肯定不信，恩，我也不信！
但是，CAPM是一个理想的模型，他有7大前提条件，这里就保证了结论的有效性。

7大假设：

>1) 没有交易成本(佣金、买卖价差等)。
>2) 没有税收。
>3) 所有资产都可以任意交易，并且无限可分。
>4) 完全竞争:所有人都是价格的接受者，没有影响价格的能力。
>5) 所有人都以均值方差的方式选择投资组合:偏好更高的期望回报率，以及更低的回报率 波动率。
>6) 所有资产(包括无风险资产)都可以任意买空卖空。
>7) 一致预期:所有人针对相同的时间区间(1 期)考虑投资问题，并对资产的预期回报率和预期波动率状况有相同预期。


这个理论的伟大意义在于，他对资产定价，提出了一个相对合理的模型，这个是跨时代的，后面的各种资产定价理论也都源于它。

>如果市场组合与整个市场不同，则某些资产的供需一定不平衡，从而必然 引发资产价格调整，最终使得市场组合一定等同于整个市场。


它的推导证明就不给出了，教材上都有，也可以[参考这篇](https://wenku.baidu.com/view/10ef5d8dba0d4a7302763a7f.html)，我也其实也不太关心，我主要关心的是这玩意怎么用？

基于CAPM，就可以**推导出**的**CAMP公式**，它可以用来给任何一个风险资产计算收益率：收益率和市场组合的收益率之间关系：

$$
E\left(r_{i}\right)-r_{f}=\frac{\sigma_{i M}}{\sigma_{M}^{2}}\left[E\left(r_{M}\right)-r_{f}\right] \\

\beta_{i}=\sigma_{i M} / \sigma_{M}^{2} \\

E\left(r_{i}\right)-r_{f}=\beta_{i}\left[E\left(r_{M}\right)-r_{f}\right]
$$

这式子表达了什么？

市场上的各种风险资产，它们的期望回报率$$E(r_{i})$$，存在线性关系。它们都分布在一条截距为$$r_f$$，斜率为$$E(r_M)-r_f$$的直线上，
这根直线就是**证券市场线SML**。

### SML和CML

**区分一下证券市场线SML和前面的资本市场线CML**

对比他们的公式：

$$
\begin{aligned}
&SML: E\left(r_{i}\right)=r_{f}+\beta_{i}\left[E\left(r_{M}\right)-r_{f}\right] \\
&CML: E\left(r_{i}\right)=r_{f}+\frac{\sigma_{i}}{\sigma_{M}}\left[E\left(r_{M}\right)-r_{f}\right]
\end{aligned}
$$

长的很像，对不对？但是，其实他们的区别很大！

![](/images/20211015/1634284709890.jpg)

这样图，说明的很清楚：
- 资本市场线CML，用来表达无风险加上有风险资产的组合的收益率和波动率之间的关系，它是资产最优组合M和$$r_f$$的连线，截距是$$r_f$$,斜率是$$\frac{E(r_M)-r_f}{\sigma_M}$$，x是无风险和有风险资产组合的标准差（波动率），y是预期收益率$$E(r)$$
- 证券市场线SML，说的是每一个资产$$r_i$$和全市场组合$$r_M$$的比例关系，截距是$$r_f$$，斜率是$$E(r_M)-r_f$$，x是$$\beta_i$$，，y是预期收益率$$E(r)$$

### $$\beta$$

我们可以采集一个股票的每月的收益率$$r_i$$，我们得到一系列的时间序列；然后我们用指数的收益率近似代替市场收益率$$r_M$$；
然后我们就可以通过一个一元回归分析，可以求解出$$\beta_i$$，也就是得到这个资产的$$\beta$$系数,
这个系数说明了什么？它说明了，这个资产的收益率$$r_i$$和市场收益率$$r_M$$的关系，比如正相关，负相关，
某种程度反映着这个资产受市场波动的影响程度。

除了用一元回归可以求解$$\beta$$外，你还可以通过协方差求解：

还记得前面$$\beta$$的定义么? 

$$\beta_{i}=\sigma_{i M} / \sigma_{M}^{2}$$

所以，你就可以通过计算股票的每月收益率$$r_i$$，和这个月对应的市场的收益率$$r_M$$，然后按照上式，计算出响应的$$\beta$$。

### 夏普指数

夏普指数：
$$ S R_{i}=\frac{E\left(r_{i}\right)-r_{f}}{\sigma\left(r_{i}\right)} $$

夏普指数，就是刻画，你单位风险下的的收益率。有点抽象，其实很简单，举个例子，比如无风险收益是3%，产品A是23%年化收益率，产品B是13%的年化收益率，但是A的风险是4%（风险就是方差），而B的风险是1%，那么，产品A的夏普指数是 $\frac{23%-3%}{4%}=5$，而产品B的夏普指数是 $\frac{13%-3%}{1%}=10$，那么产品B其实是更好的投资标的，大白话，就是，我不能光看收益率高就买它，我还得看风险大不大，两个的比值大的那个，最好！

### CAPM的妙用

简化协方差计算：

我们组合N个资产，我问你组合的方差是多少，怎么算？

通过$$\beta$$，我们可以大大简化这个组合资产的方差计算。

## 因子模型

不同于CAPM那么强的、那么多的假设，能不能少点假设，还能推出资产定价呢？恩，这个就是APT要研究的。

不过为了研究APT，得先搞出一个因子模型，它更偏数学，纯粹就是用一个线性模型，引入一个因子的概念，把资产的收益肢解成因子和线性组合。
（注意，还没到市场假设的地步，市场假设是有APT那边才提出，这就就是偏数学的假设，后面会提，别急）

因子模型就假设资产收益是有一个线性的模型来构建：

$$r_{it}=a_{i}+b_{i 1} F_{1t}+b_{i 2} F_{2t}+\cdots+b_{i k} F_{kt}+e_{it}$$

先看一眼这个式子，我不解释，我先简化它成一个因子，在一个因子模型（单因子）里，再好好解释他们每一项。

### 单因子

好，我们来把因子模型，简化到只有一个因子：

$$r_{it} = \alpha_i + \beta_i F_t + e_{it}$$

这个式子包含几个强假设或者叫约束（这玩意是数学约束，不过，其实也不算，它还是有点业务含义，但是绝不是CAPM和APT的那些更偏市场的假设）：
- 随机误差$$e_i$$和因子$$F$$不相关
- 不同资产的的随机误差也不相关：$$e_i,e_j$$不相关
如果相关（可以通过相关性假设检验来确认），就应该可以出另外一个更精确的收益率的因子模型公式出来，可能再多出一到多个因子来。

看这个公式，需要说明一下：
- $$r_{it}$$，下标有个t，说明是对序列中某个值的，比如某天的、某月、某年的收益率，他受到对应天的因子值$$F_t$$的影响
- 因子$$F$$，它影响资产收益$$r_{it}$$的波动，他带来风险（波动），它可能是天气、可能是大盘、可能是税收啥的，啥都可以，但是，他们都有一个共通特点，就是是一个普遍性因素，他不仅影响我这个资产，也影响别人的资产，他是个和我的这个资产个例无关的，个例资产相关的我举个例子，比如老板跑路，厂房着大火之类的因素，这些个例因素，
都被归集到了$$e_i$$中了。另外，它是一个时间序列值，比如大盘，是每天、每月、每年的收益率。
- $$\beta$$，就是来刻画，我这个资产，受对应因子的影响程度的，因子是变来变去的，有自己的均值、方差、趋势，我们（要计算的资产）被他（因子）左右、影响，系数$$\beta$$就是影响的大小。
- $$ \alpha_i$$，是个啥，书上其实都没讲清楚，我觉得是一个不受因子$$F_t$$影响的收益，徐高的书上说是期望回报率，他还用了$$\bar{r}_i$$来表示，很是让人费解。
我觉得，就是一个横竖，你这个资产可以拿到的一个稳定的收益，如果类别CAPM，对应的就是无风险收益$$r_f$$，对应这个资产，横竖都可以拿到的收益。
注意，他是个数，也就是说，他是个稳定的值。
- 那$$e_{it}$$呢，就是这个资产的个体风险，咋理解？我理解就是排除了因子们影响的个体的收益波动，比如知乎上的帖子说的，你这个农场发生水灾了导致收益的波动。另外，残差项的期望为0：$$E(e_i)=0$$，为何=0呢？是因为，我们是用拟合来求解，这个模型的，那残差项就是$$e_i$$，他的数学含义就是这样，在线性回归中，我们知道$$E(e_i)=0$$。
- 下标说明一下：i表示某一个资产，而t表示每个时间

那么，自然地，你可能会问，这个$$e_{it}$$里还藏着一些共同因素的风险咋办？比如出生率（我觉得比较变态的例子）因素，其实没有被单独拎出来，
它其实藏在这个个体风险$$e_{it}$$中，那我这个线性预测就不准了吧。对，这个是个好问题！我说说我的理解，我觉得，这个正是前面说的3个假设
的重要性，即因子间、因子和某个资产的个体风险、不同的资产的个体风险间，这3个配对，都要无关。在我看来，这其实是一个非常非常强的假设，
臣妾是做不到的。因子多了去了，你也没法穷举，你只能不断地挖掘，你只能找到更多的无关的因子们，让藏在个体风险$$e_{it}$$中的因子们从个体风险$$e_{it}$$
尽量的剥离出来，让你的模型越来越精确地去刻画资产的定价。

其实有个trick，实现的时候，就是你找到一个因子，或者别的因子，获得多个因子，比较他们的优劣的时候，可以变相地去检验，他们拟合后的残差，也就是个体风险$$e_{it}$$的相关性，即资产1和资产2的个体风险$$e_{it}$$，他们是不是相关，从来反向验证你的因子选择和模型的好坏。

### 多因子

现在来看，多因子的线性模型：

$$r_{it}=a_{i}+b_{i 1} F_{1t}+b_{i 2} F_{2t}+\cdots+b_{i k} F_{kt}+e_{it}$$

其中个，$$F_i$$是因子，对比单因子，它有多个了，恩，将来，你也得用多元回归来做了。
他们每个人，都是一个时间序列，是真实世界存在的序列，比如GPD每年变化率+人口出生变化率+...，多个，都能拿到。


各因子之间，因子与误差项之间，误差项之间，还是要保持前面单因子的那个约束，即协方差应该都为0：

$$cov(F_{it_1},F_{it_2})=0, cov(F_i,e_i)=0,  cov(e_{it_1},e_{it_2})=0$$，

还是那句话，如果不独立，说明，残差项$$e_i$$中，还有些信息没有被提取出来，应该还可以再抽象出一个新的因子，这个模型还需要再挖掘。
（相关性检验，是个方法好，可以用来做模型好坏的一个检验标准）

### 总结

CAPM假设太强，所以夏普提出了这个简化的因子模型，就3个要求，试图简化解释资产的收益的解释，啥都可以是因子，你自己找吧。
这玩意提出来，就可以推导后续的资产套利理论啦。另外，这玩意，也可以简化组合资产的方差、协方差计算，可以降低计算数量级。
还有现在的多因子模型的量化，也是基于它，可以说它是理论基础。后面的著名的Fama-French三因子，就是其中的一个应用而已。

这里的词比较，你可千万别晕啊，我再给你掰吃掰吃：
- 多个资产$$r_i$$各自有自己的$$\alpha_i$$和$$\beta_i$$
- 多个资产$$r_i$$之间可以组合起来得到$$r_p$$
- 一个资产受多个因子$$F_j$$影响，我为了区别，用了下标$$j$$
- 组合资产$$r_p$$其实也受多个因子$$F_j$$的影响，如果你知道每个资产的$$\alpha_i,\beta_i$$，就可以比较方便的计算出组合资产$$r_p$$的$$\alpha_p,\beta_p$$

## ATP



还记得之前CAMP的7个假设么？太多限制了！另外，CAMP中决定资产收益的变量只有$$\beta$$，我们管它叫**“”**。

他只有市场一个因素，APT是一个泛化模型，可以随意定义因子。

“套利资产定价理论”

>在已知某些资产的价格之后，怎样给 其他一些相关的资产定价。从这个意义上来说，无套利定价理论也可被称为“相对定价”。
无套利定价理论的思想就是资产市场中应当不存在套利机会。
无套利定价理论就比均衡定价理论更优越。两套理论分别代表了两 条不同的思路，都有着各自的利弊。

罗斯于 1976 年首次提出的“套利资产定价理论”(Arbitrage Pricing Theory， 简称 APT)

是 Fama 与 French 提出的三因子模型(Fama，French，1993) 具有开创性。
Fama 与 French 用市场组合的超额收益率、规模、和账面市值 比 3 个因子来解释不同资产回报率

$$\tilde{r}_{i}-r_{f}=\alpha_{i}+\beta_{i M}\left(\tilde{r}_{M}-r_{f}\right)+\beta_{i s} \tilde{S} M B+\beta_{i h} \tilde{H} M L+\tilde{\varepsilon}_{i}$$

- $$\tilde{S}MB$$: 是市值因子，表征了上市公司的规模大小
- $$\tilde{H}ML$$: 是账面市值比(book to market)， 是公司的账面价值除以公司股票总市值

三因子模型的解释效果就比 CAPM 所对应的 单因子模型好了很多

所谓因子，实际上是会影响随机 折现因子的不确定性来源。

资产的期望收益率是由一些共同的因子所决定的。不同的资产对不 同因子的敏感性不一样，因而造成了不同资产期望回报率的不同

至于这些因子是什么，它 们与不同资产之间的关系是怎样的，多因子模型并不从理论上加以回答，而将其留给实践操 作来确认。也就是说，应用多因子模型的投资者需要自行决定哪些因子是重要的，需要用来 分析资产回报率。


从实践的角度来看，APT 和因子模型是相当抽象的，既没有告诉我们因子是什 么，该怎么去选取，也没有告诉我们资产对各个因子的敏感性如何估计。但这恰恰是 APT 理论一般性、灵活性的体现。

我们将其称为因子风险 (factor risk)。因子前的系数 β 叫做资产对因子的载荷(loading)。与因子风险无关的剩余 风险$$\tilde{\epsilon_i}$$叫做个体风险(idiosyncratic risk)

CAPM 视为 APT 的一个特例。就 CAPM 看来，所有资产的期望回报率只 有一个因子决定，就是市场组合的回报率。而各个资产对因子的敏感度就是各个资产的 β。 所以，我们可以把 CAPM 视为一个单因子模型。

APT的三个基本假设：
- 因素模型能描述证券收益；
- 市场上有足够的证券来分散风险；
- 完善的证券市场不允许任何套利机会存在








## 无风险套利

## Fama四因子

## 选基量化模型


### boostraping

### Jensen's Alpha

### TM模型

### TB模型

### HM模型

### CL模型

### 晨星公募模型


# 数据库

- [https://uqer.datayes.com/](https://uqer.datayes.com/) 优矿
- [http://tushare.org/](http://tushare.org/)
- [http://quantapi.eastmoney.com/?from=web](http://quantapi.eastmoney.com/?from=web) 天天基金
- [https://www.wind.com.cn/NewSite/data.html](https://www.wind.com.cn/NewSite/data.html) 万德wind
- [http://quantapi.10jqka.com.cn/?page=home](http://quantapi.10jqka.com.cn/?page=home)  同花顺
- [http://baostock.com/baostock/index.php/首页](http://baostock.com/baostock/index.php/%E9%A6%96%E9%A1%B5)  证券宝www.baostock.com是一个免费、开源的证券数据平台
- [https://www.akshare.xyz/zh_CN/latest/index.html](https://www.akshare.xyz/zh_CN/latest/index.html) 这个最实用
- [https://github.com/jindaxiang/akshare](https://github.com/jindaxiang/akshare) ，开源代码
- [https://datacenter.jin10.com/](https://datacenter.jin10.com/)
- [https://ycjq.95358.com/](https://ycjq.95358.com/)
- [https://www.joinquant.com/user/login/index](https://www.joinquant.com/user/login/index)  这个也免费


# 参考
- [回形针：基金经理对你的钱做了什么?](https://weibo.com/6414205745/KczNjyVZK?type=comment&layerid=4629975338326088)，帮助你解了基金的一些知识。
- [回形针：为什么你炒股总是亏钱？](https://www.bilibili.com/video/BV11J411K7tw/?spm_id_from=333.788.recommend_more_video.1)
- [柴知道：如何科学投资你的辛苦钱？科学理财为什么这么难？](https://www.bilibili.com/video/av844339890/)，通俗易懂的给你讲了最优风险组合理论。
- [博迪 -《投资学（原书第10版）》](https://book.douban.com/subject/27159606/)，最经典的投资学教材，没有之一。
- [中央财经大学-投资学（国家级精品课）](https://www.bilibili.com/video/BV1C4411X7zU?p=78&t=41)，刘志东老师讲的部分最有用。
- [清华大学 - 投资学](https://www.xuetangx.com/learn/thu02011003130/thu02011003130/5894332/video/9307292)，清华大学的王茵田教授的投资客讲解，也非常通俗易懂。
- [王蓁老师 - 金融量化/股票交易投资教程](https://www.bilibili.com/video/BV1si4y1T7BY?p=4&spm_id_from=pageDriver)，这个是一个难的的专门讲述量化的课程，比一般的那种高频交易，CTA啥的实在有用得多。
- [李锦堂 - 我如何分配我的收入](https://www.bilibili.com/video/BV17b41187PA)，我很喜欢的马来清华小哥，他对标普S&P500的讲解通俗易懂。
- [徐高 -《金融经济学二十五讲》](https://www.bilibili.com/video/BV1Bx411d714)，徐高的金融学，讲的很透彻，强烈推荐。
- [徐高 -《宏观经济学二十五讲：中国视角》](https://www.bilibili.com/video/BV1oE411Z7TU/)，徐高的宏观经济学，讲的很不错。
- [林毅夫 - 中国经济专题北京大学 ](https://www.bilibili.com/video/BV1ob411J7WC/)，了解中国经济，还要听中国经济学家的讲解。